#!/usr/bin/perl -w
# Aroon Chande
# Convert ANI table to beeswarm compatible tsv
use strict;
use Statistics::R;
open TSV, $ARGV[0] or warn "Cannot open $ARGV[0]: $!";
my $infile=$ARGV[1];
my %values;
my @tsv = <TSV>;
close TSV;
my @cols = split(/\t/, shift @tsv);
foreach (@tsv){
	my @index = split(/\t/,$_);
	for (my $i = 1; $i < @cols; $i++){
		chomp $index[$i];
		chomp $cols[$i];
		chomp $index[0];
		$values{$index[0]}{$cols[$i]} = $index[$i];
		}
}
open OUT, ">$ARGV[1].byani.tsv";
print OUT "name\tani\tgroup\tcol\n";
foreach my $key1 (keys %values){
	foreach my $key2 (keys %{$values{$key1}}){
		my $group = $values{$key1}{$key2} * 100;
		($group) = $group =~ m/(^\d*)/;
		if (($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/)){
		print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t1\n";}
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t2\n";
		} 
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t3\n";
		}
		
		elsif ((($key1 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t4\n";
		}
		elsif ((($key1 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t5\n";
		}
		elsif ((($key1 =~ /H\./) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t6\n";
		}
		elsif ((($key1 =~ /H\./) && ($key2 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t7\n";
		} 
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /H\./))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t8\n";
		} 
	
	}
	
}
close OUT;
open OUT, ">$ARGV[1].species.tsv";
print OUT "name\tani\tgroup\tcol\n";
foreach my $key1 (keys %values){
	foreach my $key2 (keys %{$values{$key1}}){
		my $group = $values{$key1}{$key2} * 100;
		($group) = $group =~ m/(^\d*)/;
		if ($group < 95){$group = "Different Species";}
		elsif ($group >= 95){$group = "Same Species";}
		if (($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/)){
		print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t1\n";}
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t2\n";
		} 
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t3\n";
		}
		
		elsif ((($key1 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t4\n";
		}
		elsif ((($key1 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t5\n";
		}
		elsif ((($key1 =~ /H\./) && ($key2 =~ /M03959|M04744|M04827|M04828|M05964|M06436|M07055|M07066|M07572|M08234|M08351|M09394|M10178|M10210|M10230|M10364|M10482|M10540|M10991|M11311|M11363|M11600|M11696|M11840|M11879|M11900|M11908|M11921|M11955|M12066|M12084|M12086|M12178|M12252|M12353|M12373|M12969|M13539|M14002|M14079|M14416|M14444|M14486|M14626|M14700|M15301|M15928|M16180|M16690|M16860|M23816|M24471|M24820|M25147|M25364|M25693|M26026|M26032|M26429|M27986|M27987|M28356|M28405|M28687|M28702|M28745|M28770|M28801|M28853|M28888|M29179|M29197|M29202|M29227|M29307|M29323|M29331|M29400|M29658|M29684|M29695|M29697|M36557|M36564|M36580|M36582|M36605|M36606|M37248|M37982|M3825|M3835|M3844|M6399/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t6\n";
		}
		elsif ((($key1 =~ /H\./) && ($key2 =~ /M19107|M19501|M21127|M21621|M21639|M25342|M11818|M19476|HK386|M16859|M21639|M21501|M19080|M16386/))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t7\n";
		} 
		elsif ((($key1 =~ /86-028NP|2019|10810|CGSHiCZ412602|F3031|F3047|KR494|NCTC8143|PittEE|PittGG|R2864|R2866|RdKW20/) && ($key2 =~ /H\./))){
			print OUT "$key1.$key2\t$values{$key1}{$key2}\t$group\t8\n";
		} 
	
	}
	
}

close OUT;
my $R = Statistics::R->new();
$R->run(q'library(beeswarm)');
$R->run(qq`postscript("$infile.byani.ps", horizontal=FALSE, width=1000, height=1000)`);
$R->run(qq`data = read.table("$infile.byani.tsv", sep = "\t", header = TRUE, row.names=1)`);
$R->run(q`beeswarm(ani ~ group, data = data, pch=16, pwcol = data$col, pwbg = data$col, method = "hex", corral = "omit", cex = .5)`);
$R->run(q`dev.off()`);
$R->run(qq`postscript("$infile.species.ps", horizontal=FALSE, width=1000, height=1000)`);
$R->run(qq`data = read.table("$infile.species.tsv", sep = "\t", header = TRUE, row.names=1)`);
$R->run(q`beeswarm(ani ~ group, data = data, pch=16, pwcol = data$col, pwbg = data$col, method = "hex", corral = "omit", cex = .5)`);
$R->run(q`dev.off()`);
$R->stop();
exit 0;
